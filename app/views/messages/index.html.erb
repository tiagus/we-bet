<link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>

<div class="container-wide p-5 my-auto">
    <div class="row">
        <div class="col-5 m-5">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <span class="glyphicon glyphicon-user"></span> Users
                    <div class="btn-group pull-right">
                        <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">
                            <span class="glyphicon glyphicon-chevron-down"></span>
                        </button>
                        <ul class="dropdown-menu slidedown">
                          <% current_user.groups.each do |group| %>
                            <li><a href="#"><span class="glyphicon glyphicon-star">
                            </span><%= link_to group.name, group_path(group) %></a></li>
                            <% end %>
                        </ul>
                    </div>
                </div>
                <div class="panel-body-1">
                    <ul class="chat">
                        <% @users.each do |user| %>
                        <li class="left clearfix"><span class="chat-img pull-left">
                          <% if user.profile.photo.attached? %>
                            <%= cl_image_tag user.profile.photo.key, width: 50, height: 70, radius: 100 %>
                      <% end %>
                        </span>
                            <div class="chat-body clearfix">
                                <div class="header">
                                  <strong class="primary-font"><%= link_to user.profile.username, conversations_path(sender_id: current_user.id, receiver_id: user.id), method: :post %></strong> <small class="pull-right text-muted">
                                  <span class="glyphicon glyphicon-time"></span><%= user.created_at.strftime('%a, %d %b %Y %H:%M ') %></small>
                                </div>
                                <p><%= @messages.where(user_id: user.id).last %></p>
                            </div>
                        </li>
                      <% end %>
                    </ul>
                </div>
                <div class="panel-footer">
                </div>
            </div>
        </div>
        <div class="col-6 m-5">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <span class="glyphicon glyphicon-comment"></span> Messages
                </div>
                <div class="panel-body">
                  <ul class="chat">
                      <% @messages.each do |message| %>
                      <li class="left clearfix"><span class="chat-img pull-left">
                        <% if message.user.present? %>
                        <% if message.user.profile.photo.attached? %>
                          <%= cl_image_tag message.user.profile.photo.key, width: 50, height: 70, radius: 100, background_removal: 'pilaz' %>
                        <% end %>
                      </span>
                          <div class="chat-body clearfix">
                            <div class="header">
                              <strong class="primary-font"><%= message.user.profile.username %></strong> <small class="pull-right text-muted">
                              <span class="glyphicon glyphicon-time"></span><%= message.created_at.strftime('%a, %d %b %Y %H:%M ') %></small>
                            </div>
                              <p><%= message.body %></p>
                           </div>
                        </li>
                    <% end %>
                    <% end %>
                    </ul>
                </div>
                <div class="panel-footer">
                  <div class="input-group">
                    <%= simple_form_for [@conversation, @message] do |f| %>
                    <div class="field">
                      <%= f.text_area :body, placeholder: "Let's bet!", class: 'form-control input-sm', id:"btn-input" %>
                    </div>
                    <%= f.submit "Send", class: 'btn btn-warning btn-block float-right mt-3', id: "btn-chat"  %>
                    <% end %>
                  </div>
                </div>
            </div>
        </div>
    </div>
</div>
